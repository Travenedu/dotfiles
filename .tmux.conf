unbind r
bind r source-file ~/.tmux.conf

# unbind and rebind t for easier terminal access
unbind t

set -g default-terminal "tmux-256color"
set-option -sa terminal-features ',xterm-256color:RGB'

# Set prefix
set -g prefix C-a

# theme terminal message
set -g message-style "fg=#cdd6f4,bg=#1e1e1e"

# Set mouse
set -g mouse on
setw -g mode-keys vi

# Start windows and panes at 1, not 0
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on
set -g detach-on-destroy off

# Modern rounded corners for all popups
set -g popup-border-lines "rounded"
set -g popup-border-style "fg=#cba6f7"

# Allow for customizing tab names using bash precmd_functions
set-option -g allow-rename on

# split panes using | and -
bind - split-window -v
bind | split-window -h
unbind '"'
unbind %

bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# Easier and faster switching between next/prev window
bind C-p previous-window
bind C-n next-window

# Move status bar to the top
set-option -g status-position top

# Super useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on

# Increase tmux messages display duration from 750ms to 4s
set -g display-time 4000

# Display Popups
# Open lazygit
bind L display-popup \
  -d "#{pane_current_path}" \
  -w 80% \
  -h 80% \
  -E "lazygit"

# Create a new session
bind N display-popup -E 'bash -i -c "read -p \"Session name: \" name; tmux new-session -d -s \$name && tmux switch-client -t \$name"'

# Get current tmux sessions
bind J display-popup -E "tmux list-sessions -F '#S' | grep -v \"^#(tmux display-message -p '#S')\$\" | fzf --reverse | xargs tmux switch-client -t"

# Open zshrc
bind Z display-popup \
  -w 80% \
  -h 80% \
  -E 'nvim ~/.zshrc'

# # Open terminal
bind t display-popup \
  -d "#{pane_current_path}" \
  -w 75% \
  -h 75% \
  -E "bash -c 'tmux attach -t Terminal || tmux new-session -s Terminal -c \"#{pane_current_path}\" zsh'"

bind N display-popup \
  -w 80% \
  -h 80% \
  -E 'nvim ~/Documents/Coding/Notes/'

# Open Gemini
bind G display-popup \
  -d "#{pane_current_path}" \
  -w 75% \
  -h 75% \
  -E "bash -c 'tmux attach -t gemini || tmux new-session -s gemini -c \"#{pane_current_path}\" gemini'"

# Styling

# Status bar position, style, justification
set -g status-position top
set -g status-style "bg=#1E1E1E,fg=#585b70"
set -g status-justify absolute-centre

# Status left (session name, prefix indicator)
set -g status-left "\
#[fg=#a6e3a1]#{?#{==:#{continuum_status},off},#[fg=#f38ba8] fence ,#[fg=#a6e3a1] 󱣪} \
#[bg=#1E1E1E,fg=#cdd6f4]#{?client_prefix,, #S }#[bg=#cba6f7,fg=#1E1E1E,bold]#{?client_prefix, #S ,}#[bg=#1E1E1E,fg=#9399b2]"

# Status right (still disabled by default, since @tmux-dotbar-right = false)
# Status right (system info)
set -g status-right "\
#[fg=#b4befe] #[fg=#cdd6f4]#([ #{pane_current_path} = $HOME ] && echo '~' || basename #{pane_current_path}) \
#[fg=#b4befe] #[fg=#cdd6f4]#(date +%m/%d) \
#[fg=#b4befe] #[fg=#cdd6f4]#(date +%l:%M%p) "

# Copy mode styling
set -g mode-style "bg=#b4befe,fg=#1A1D23"

# Window status separator (between tabs)
set-window-option -g window-status-separator " • "

# Window status styles
set -g window-status-style "bg=#1E1E1E,fg=#585b70"
set -g window-status-format " #W "

# Current window status format (active tab, with zoom icon if maximized)
set -g window-status-current-format "#[bg=#1E1E1E,fg=#cdd6f4] #W #[fg=#39BAE6,bg=#1E1E1E]#{?window_zoomed_flag,󰊓,}#[fg=#1E1E1E,bg=default]"

# -----------------------------------------------------------------------------
# Plugins
# -----------------------------------------------------------------------------
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'sainnhe/tmux-fzf'

# -----------------------------------------------------------------------------
# Plugin Settings
# -----------------------------------------------------------------------------

# tmux-resurrect settings
# This allows resurrect to capture what's running inside nvim and pane contents
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-capture-pane-contents 'on'

# tmux-continuum settings
set -g @continuum-restore 'on'
set -g @continuum-boot 'on'
set -g @continuum-save-interval '15'

# tmux-yank settings
# Stay in copy mode after yanking (stops it from jumping to the bottom)
set -g @yank_action 'copy-pipe'

# Set the launch key for tmux-fzf
TMUX_FZF_LAUNCH_KEY="f"

# (Optional) Customize the popup size to match your other popups
set -g @tmux-fzf-launch-key 'f'
set -g @tmux-fzf-options '-p -w 80% -h 70% -m'

# Fuzzy find URLs and open them
bind-key "u" run-shell -b "~/.tmux/plugins/tmux-fzf/scripts/url.sh"

# -----------------------------------------------------------------------------
# Initialize TMUX plugin manager (Keep this at the very bottom)
# -----------------------------------------------------------------------------
run '~/.tmux/plugins/tpm/tpm'

